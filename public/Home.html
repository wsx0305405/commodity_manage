<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width">
    <title>Home</title>
    <style>
        #result{
            width: 1300px;
            height: 900px;
            border: solid 1px ;
        }
    </style>
    <script src="https://unpkg.com/axios@1.1.2/dist/axios.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
</head>
<body>
    <nav class="navbar navbar-expand-lg bg-body-tertiary">
        <div class="container-fluid">
          <a class="navbar-brand" href="#">Product Management System</a>
          <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav">
                <li class="nav-item">
                    <button type="button" class="btn btn-outline-secondary" disabled>Product</button>
                </li>
                <li class="nav-item">
                    <button type="button" class="btn btn-outline-secondary">Order</button>
                </li>
                <li class="nav-item">
                    <button type="button" class="btn btn-outline-secondary" disabled>AddOrder</button>
                </li>
                <li class="nav-item">
                    <button type="button" class="btn btn-outline-secondary" disabled>Register</button>
                </li>
                <li class="nav-item">
                    <button type="button" class="btn btn-outline-secondary" disabled>Login</button>
                </li>
            </ul>
          </div>
        </div>
      </nav>

    <div class="container pt-5 pb-5">
    <div id="result">
        <table class="table">
            
        </table>    
    </div>
    <script>
        const btns = document.querySelectorAll('button');
        const table = document.querySelector('table');
        axios.defaults.baseURL = 'http://127.0.0.1:3000';

        btns[0].onclick = function(){
            axios({
                method: 'get',
                url: '/product',
            }).then(products => {
                var thead = document.createElement('thead');
                table.appendChild(thead);
                var tr = document.createElement('tr');
                thead.appendChild(tr);
                var td = document.createElement('td');
                tr.appendChild(td);
                td.innerHTML = '商品名';
                var td = document.createElement('td');
                tr.appendChild(td);
                td.innerHTML = '編號';
                var td = document.createElement('td');
                tr.appendChild(td);
                td.innerHTML = '價格';
                var td = document.createElement('td');
                tr.appendChild(td);
                td.innerHTML = '數量';
                var td = document.createElement('td');
                tr.appendChild(td);
                td.innerHTML = '敘述';
                var td = document.createElement('td');
                tr.appendChild(td);
                td.innerHTML = 'Action';

                var tbody = document.createElement('tbody');
                table.appendChild(tbody);
                
                for(let i = 0;i < products.data.length; i++){
                    var tr = document.createElement('tr');
                    tbody.appendChild(tr);
                    var th = document.createElement('th');
                    tr.appendChild(th);
                    th.innerHTML = products.data[i].name;
                    var td = document.createElement('td');
                    tr.appendChild(td);
                    td.innerHTML = products.data[i].id;
                    var td = document.createElement('td');
                    tr.appendChild(td);
                    td.innerHTML = products.data[i].price;
                    var td = document.createElement('td');
                    tr.appendChild(td);
                    td.innerHTML = products.data[i].quantity;
                    var td = document.createElement('td');
                    tr.appendChild(td);
                    td.innerHTML = products.data[i].remark;

                    var td = document.createElement('td');
                    tr.appendChild(td);
                    td.innerHTML = '<a href="#" class="btn btn-light btn-small">Edit</a> <a href="#" class="btn btn-light btn-small">Delete</a>';
                }
            })
        }

        btns[1].onclick = function(){
            axios({
                method: 'get',
                url: '/order',
            }).then(response => {
                table.innerHTML = '';
                var thead = document.createElement('thead');
                table.appendChild(thead);
                var tr = document.createElement('tr');
                thead.appendChild(tr);
                var td = document.createElement('td');
                tr.appendChild(td);
                td.innerHTML = '*';
                var td = document.createElement('td');
                tr.appendChild(td);
                td.innerHTML = '訂單編號';
                var td = document.createElement('td');
                tr.appendChild(td);
                td.innerHTML = '會員編號';
                var td = document.createElement('td');
                tr.appendChild(td);
                td.innerHTML = '產品編號';
                var td = document.createElement('td');
                tr.appendChild(td);
                td.innerHTML = '數量';
                var td = document.createElement('td');
                tr.appendChild(td);
                td.innerHTML = '價格';
                var td = document.createElement('td');
                tr.appendChild(td);
                td.innerHTML = 'Action';

                var tbody = document.createElement('tbody');
                table.appendChild(tbody);
                
                for(let i = 0;i < response.data.length; i++){
                    var tr = document.createElement('tr');
                    tbody.appendChild(tr);
                    var th = document.createElement('th');
                    tr.appendChild(th);
                    th.innerHTML = '訂單' + (i+1);
                    var td = document.createElement('td');
                    tr.appendChild(td);
                    td.innerHTML = response.data[i].order_id;
                    var td = document.createElement('td');
                    tr.appendChild(td);
                    td.innerHTML = response.data[i].member_id;
                    var td = document.createElement('td');
                    tr.appendChild(td);
                    td.innerHTML = response.data[i].product_id;
                    var td = document.createElement('td');
                    tr.appendChild(td);
                    td.innerHTML = response.data[i].order_quantity;
                    var td = document.createElement('td');
                    tr.appendChild(td);
                    td.innerHTML = response.data[i].order_price;

                    var td = document.createElement('td');
                    tr.appendChild(td);

                    var edit_button = document.createElement('button');
                    edit_button.innerHTML = 'edit';

                    edit_button.onclick = async function(){
                        table.innerHTML = '';

                        var div = document.createElement('div');
                        div.className = 'col-6';
                        table.appendChild(div);

                        var label = document.createElement('label');
                        label.className = 'form-label';
                        label.innerText = ' order_id ';
                        var input = document.createElement('input');
                        input.id = 'order_id';
                        input.type = 'text';
                        input.className = 'form-control';
                        input.name = 'oid';
                        input.value = response.data[i].order_id;
                        input.disabled;

                        div.appendChild(label);
                        div.appendChild(input);

                        var div = document.createElement('div');
                        div.className = 'col-6';
                        table.appendChild(div);

                        var label = document.createElement('label');
                        label.className = 'form-label';
                        label.innerText = ' member_id ';
                        var input = document.createElement('input');
                        input.id = 'member_id';
                        input.type = 'text';
                        input.className = 'form-control';
                        input.name = 'mid';
                        input.value = response.data[i].member_id;
                        input.disabled;

                        div.appendChild(label);
                        div.appendChild(input);

                        var div = document.createElement('div');
                        div.className = 'col-6';
                        table.appendChild(div);

                        var label = document.createElement('label');
                        label.className = 'form-label';
                        label.innerText = ' product_id ';
                        var input = document.createElement('input');
                        input.id = 'product_id';
                        input.type = 'text';
                        input.className = 'form-control';
                        input.name = 'pid';
                        input.value = response.data[i].product_id;
                        input.disabled;

                        div.appendChild(label);
                        div.appendChild(input);

                        var div = document.createElement('div');
                        div.className = 'col-6';
                        table.appendChild(div);

                        var label = document.createElement('label');
                        label.className = 'form-label';
                        label.innerText = ' quantity ';
                        var input = document.createElement('input');
                        input.id = 'quantity';
                        input.type = 'text';
                        input.className = 'form-control';
                        input.name = 'quantity';
                        input.value = response.data[i].order_quantity;
                        input.disabled;

                        div.appendChild(label);
                        div.appendChild(input);

                        var update = document.createElement('button');
                        update.name = 'update';
                        
                        table.appendChild(update);

                        update.onclick = async function(){
                                await axios({
                                method: 'put',
                                url: '/order',
                                headers: {
                                    'Content-Type': 'application/x-www-form-urlencoded',
                                },
                                data: {
                                    orderID: document.getElementById('order_id').value,
                                    memberID: document.getElementById('member_id').value,
                                    productID: document.getElementById('product_id').value,
                                    quantity: document.getElementById('quantity').value,
                                }
                            });
                            table.innerHTML = '';
                        }
                    }


                    var del_button = document.createElement('button');
                    del_button.innerHTML = 'delete';

                    del_button.onclick = async function(){
                        await axios({
                            method: 'delete',
                            url: '/order',
                            headers: {
                                'Content-Type': 'application/x-www-form-urlencoded',
                            },
                            data: {
                                orderID: response.data[i].order_id,
                                memberID: response.data[i].member_id,
                                productID: response.data[i].product_id, 
                            }
                        });
                        history.go(0);
                    }
                    td.appendChild(edit_button);
                    td.appendChild(del_button);
                
                }
            })
        }
    </script>
</body>
</html>